<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“¦ Bundled Demo</title>
    <link rel="stylesheet" href="/browser/css/design-system.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“¦ Bundled Approach Demo</h1>
            <p>Experience how bundled JavaScript works compared to native ES modules</p>
        </div>
        
        <nav class="nav">
            <a href="/" class="nav-link">ğŸ  Home</a>
            <a href="/esm-demo" class="nav-link">ğŸ“¦ ES Modules</a>
            <a href="/bundling-comparison" class="nav-link">ğŸ“Š Comparison</a>
            <a href="https://github.com/vishal83/JSModulesExploration" target="_blank" class="nav-link">ğŸ“š GitHub</a>
        </nav>
        
        <div class="demo-section">
            <h2>ğŸ“¦ Bundled JavaScript in Action</h2>
            <p>This demo loads all modules from a single bundled file (webpack-example.js):</p>
            
            <button onclick="testBundledModules()" class="btn btn-success">Test Bundled Modules</button>
            <button onclick="analyzeBundlePerformance()" class="btn btn-primary">Analyze Performance</button>
            <button onclick="compareBundleSize()" class="btn btn-secondary">Compare Bundle Size</button>
            
            <div id="bundle-output" class="output">
Click "Test Bundled Modules" to see how all functionality loads from a single file!

ğŸ“¦ Benefits of bundling:
â€¢ Single HTTP request
â€¢ Smaller total download size  
â€¢ Better browser compatibility
â€¢ Optimized and minified code
            </div>
        </div>
        
        <div class="demo-section">
            <h2>ğŸŒ Network Analysis</h2>
            <p>Compare network behavior between bundled and native approaches:</p>
            
            <div class="cards">
                <div class="card">
                    <h2>ğŸ“¦ Bundled Approach</h2>
                    <ul>
                        <li><strong>Requests:</strong> 1 JavaScript file</li>
                        <li><strong>Size:</strong> Larger but compressed</li>
                        <li><strong>Caching:</strong> All-or-nothing</li>
                        <li><strong>Loading:</strong> Everything at once</li>
                    </ul>
                </div>
                
                <div class="card">
                    <h2>ğŸ§© Native Modules</h2>
                    <ul>
                        <li><strong>Requests:</strong> Multiple files</li>
                        <li><strong>Size:</strong> Only what's needed</li>
                        <li><strong>Caching:</strong> Granular per module</li>
                        <li><strong>Loading:</strong> Lazy loading possible</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="info-box">
            <h3>ğŸ¯ When to Use Bundling vs Native</h3>
            <div class="comparison-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg); margin-top: var(--space-lg);">
                <div>
                    <h4>ğŸ“¦ Use Bundling When:</h4>
                    <ul>
                        <li>Supporting older browsers</li>
                        <li>Optimizing for HTTP/1.1</li>
                        <li>Many small modules</li>
                        <li>Need code optimization</li>
                        <li>Building production apps</li>
                        <li>Want faster initial loads</li>
                    </ul>
                </div>
                <div>
                    <h4>ğŸ§© Use Native Modules When:</h4>
                    <ul>
                        <li>Modern browser targets only</li>
                        <li>HTTP/2 is available</li>
                        <li>Development/prototyping</li>
                        <li>Want simple setup</li>
                        <li>Large applications</li>
                        <li>Need lazy loading</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Load the bundled version -->
    <script src="/examples/webpack-example.js"></script>
    
    <script>
        // This script uses the bundled modules
        console.log('ğŸ“¦ Bundled demo loaded!');
        console.log('ğŸ“Š Available from bundle:', typeof window.BundledModules);
        
        window.testBundledModules = function() {
            const output = document.getElementById('bundle-output');
            
            if (typeof window.BundledModules !== 'undefined') {
                const { mathUtils, userService, config } = window.BundledModules;
                
                // Test math utilities
                const sum = mathUtils.add(10, 15);
                const product = mathUtils.multiply(3, 7);
                
                // Test user service
                const users = userService.getAllUsers();
                const newUser = userService.addUser({
                    name: 'Bundled User',
                    email: 'bundled@example.com',
                    role: 'user'
                });
                
                output.className = 'output success';
                output.textContent = `âœ… Bundled Modules Working!

All modules loaded from single webpack-example.js file:

ğŸ§® Math Operations:
  â€¢ add(10, 15) = ${sum}
  â€¢ multiply(3, 7) = ${product}
  â€¢ PI constant = ${mathUtils.PI}

ğŸ‘¥ User Service:
  â€¢ Existing users: ${users.length}
  â€¢ New user added: ${newUser.name}
  â€¢ Total users now: ${userService.getAllUsers().length}

âš™ï¸ Configuration:
  â€¢ Environment: ${config.environment}
  â€¢ Version: ${config.version}
  â€¢ Database: ${config.database.host}

ğŸ“¦ Bundle Size: Single file contains all functionality
ğŸš€ Network Requests: Just 1 for all modules!`;
                
            } else {
                output.className = 'output error';
                output.textContent = 'âŒ Bundled modules not found. Check webpack-example.js';
            }
        };
        
        window.analyzeBundlePerformance = function() {
            const output = document.getElementById('bundle-output');
            
            // Analyze performance using Resource Timing API
            const resources = performance.getEntriesByType('resource');
            const bundleResource = resources.find(r => r.name.includes('webpack-example.js'));
            const cssResource = resources.find(r => r.name.includes('design-system.css'));
            
            let analysis = 'ğŸ“Š Bundle Performance Analysis:\n\n';
            
            if (bundleResource) {
                analysis += `ğŸ“¦ Bundle (webpack-example.js):\n`;
                analysis += `  â€¢ Size: ${(bundleResource.transferSize / 1024).toFixed(2)} KB\n`;
                analysis += `  â€¢ Load time: ${bundleResource.duration.toFixed(2)}ms\n`;
                analysis += `  â€¢ DNS lookup: ${(bundleResource.domainLookupEnd - bundleResource.domainLookupStart).toFixed(2)}ms\n`;
                analysis += `  â€¢ Connect: ${(bundleResource.connectEnd - bundleResource.connectStart).toFixed(2)}ms\n`;
                analysis += `  â€¢ Request: ${(bundleResource.responseStart - bundleResource.requestStart).toFixed(2)}ms\n`;
                analysis += `  â€¢ Download: ${(bundleResource.responseEnd - bundleResource.responseStart).toFixed(2)}ms\n\n`;
            }
            
            if (cssResource) {
                analysis += `ğŸ¨ CSS (design-system.css):\n`;
                analysis += `  â€¢ Size: ${(cssResource.transferSize / 1024).toFixed(2)} KB\n`;
                analysis += `  â€¢ Load time: ${cssResource.duration.toFixed(2)}ms\n\n`;
            }
            
            // Compare with theoretical native modules
            analysis += `ğŸ“Š Bundle vs Native Comparison:\n\n`;
            analysis += `Bundled Approach:\n`;
            analysis += `  â€¢ HTTP Requests: 2 (bundle + CSS)\n`;
            analysis += `  â€¢ Total Size: ~${((bundleResource?.transferSize || 0) + (cssResource?.transferSize || 0)) / 1024}KB\n`;
            analysis += `  â€¢ Load Strategy: Everything at once\n`;
            analysis += `  â€¢ Browser Compatibility: Excellent\n\n`;
            
            analysis += `Native Modules (estimated):\n`;
            analysis += `  â€¢ HTTP Requests: ~5-7 (individual modules)\n`;
            analysis += `  â€¢ Total Size: Similar or slightly larger\n`;
            analysis += `  â€¢ Load Strategy: Parallel but multiple requests\n`;
            analysis += `  â€¢ Browser Compatibility: Modern browsers only\n\n`;
            
            analysis += `ğŸ¯ Recommendation:\n`;
            analysis += `For production apps, bundling is usually better due to:\n`;
            analysis += `â€¢ Reduced HTTP overhead\n`;
            analysis += `â€¢ Better compression ratios\n`;
            analysis += `â€¢ Wider browser support\n`;
            analysis += `â€¢ Optimized code (minification, tree shaking)`;
            
            output.className = 'output info';
            output.textContent = analysis;
        };
        
        window.compareBundleSize = function() {
            const output = document.getElementById('bundle-output');
            
            let comparison = 'ğŸ“ Bundle Size Analysis:\n\n';
            
            // Get actual resource sizes
            const resources = performance.getEntriesByType('resource');
            const bundleResource = resources.find(r => r.name.includes('webpack-example.js'));
            
            if (bundleResource) {
                const compressedSize = bundleResource.transferSize;
                const uncompressedSize = bundleResource.decodedBodySize || bundleResource.transferSize;
                const compressionRatio = ((1 - compressedSize / uncompressedSize) * 100).toFixed(1);
                
                comparison += `ğŸ“¦ Actual Bundle:\n`;
                comparison += `  â€¢ Compressed: ${(compressedSize / 1024).toFixed(2)} KB\n`;
                comparison += `  â€¢ Uncompressed: ${(uncompressedSize / 1024).toFixed(2)} KB\n`;
                comparison += `  â€¢ Compression: ${compressionRatio}% smaller\n\n`;
                
                comparison += `ğŸ§® What's in the bundle:\n`;
                comparison += `  â€¢ Math utilities (~2KB)\n`;
                comparison += `  â€¢ User service (~3KB)\n`;
                comparison += `  â€¢ Configuration (~1KB)\n`;
                comparison += `  â€¢ Webpack runtime (~2KB)\n`;
                comparison += `  â€¢ Total bundled: ~8KB\n\n`;
                
                comparison += `ğŸ”„ Compared to individual files:\n`;
                comparison += `  â€¢ math-utils.js: ~2KB\n`;
                comparison += `  â€¢ user-service.js: ~3KB\n`;
                comparison += `  â€¢ config.js: ~1KB\n`;
                comparison += `  â€¢ Total individual: ~6KB\n\n`;
                
                comparison += `ğŸ“Š Bundle overhead:\n`;
                comparison += `  â€¢ Webpack runtime: ~2KB\n`;
                comparison += `  â€¢ Module wrapper code: ~500B\n`;
                comparison += `  â€¢ Total overhead: ~2.5KB\n\n`;
                
                comparison += `âœ… Bundle advantages:\n`;
                comparison += `â€¢ Gzip compression works better on larger files\n`;
                comparison += `â€¢ Eliminates HTTP request overhead\n`;
                comparison += `â€¢ Dead code elimination possible\n`;
                comparison += `â€¢ Code splitting for large apps`;
            } else {
                comparison += 'âš ï¸ Bundle resource not found in performance data.\n';
                comparison += 'This might be due to caching or timing.';
            }
            
            output.className = 'output info';
            output.textContent = comparison;
        };
        
        // Run initial analysis
        setTimeout(() => {
            if (typeof window.BundledModules !== 'undefined') {
                console.log('ğŸ“¦ Bundle loaded successfully!');
                console.log('ğŸ§® Math utils available:', typeof window.BundledModules.mathUtils.add === 'function');
                console.log('ğŸ‘¥ User service available:', typeof window.BundledModules.userService.getAllUsers === 'function');
            } else {
                console.warn('âš ï¸ Bundle not loaded or incomplete');
            }
        }, 100);
    </script>
</body>
</html>