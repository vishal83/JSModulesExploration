<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîÑ Dynamic Imports Demo</title>
    <link rel="stylesheet" href="/browser/css/design-system.css">
    <style>
        /* Additional styles for dynamic demo specific features */
        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-lg);
            margin: var(--space-lg) 0;
        }
        
        .perf-card {
            background: var(--bg-glass);
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .perf-number {
            font-size: var(--text-3xl);
            font-weight: 700;
            color: var(--accent-green);
            display: block;
        }
        
        .perf-label {
            color: var(--text-inverse);
            opacity: 0.8;
            font-size: var(--text-sm);
            margin-top: var(--space-sm);
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .loading-content {
            background: var(--bg-glass);
            padding: var(--space-2xl);
            border-radius: var(--radius-xl);
            text-align: center;
            color: var(--text-inverse);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            overflow: hidden;
            margin: var(--space-md) 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîÑ Dynamic Imports Demo</h1>
            <p>Explore code splitting, lazy loading, and advanced dynamic import patterns in action</p>
        </div>
        
        <nav class="nav">
            <a href="/" class="nav-link">üè† Home</a>
            <a href="/esm-demo" class="nav-link">üì¶ ES Modules</a>
            <a href="/loading-demo" class="nav-link">‚ö° Loading Demo</a>
            <a href="https://github.com/vishal83/JSModulesExploration" target="_blank" class="nav-link">üìö GitHub</a>
        </nav>
        
        <div class="demo-section">
            <h2>üöÄ Basic Dynamic Imports</h2>
            <p>Load modules on-demand at runtime using <code>import()</code>:</p>
            
            <button onclick="basicDynamicImport()" class="btn btn-success">Load Math Module</button>
            <button onclick="loadUserService()" class="btn btn-primary">Load User Service</button>
            <button onclick="loadConfigModule()" class="btn btn-secondary">Load Config Module</button>
            
            <div id="basic-output" class="output">
Click any button above to see dynamic imports in action!

üí° Dynamic imports return Promises and load modules asynchronously.
            </div>
        </div>
        
        <div class="demo-section">
            <h2>üéØ Conditional Loading</h2>
            <p>Load modules only when needed based on conditions:</p>
            
            <button onclick="conditionalImport()" class="btn btn-success">Smart Loading</button>
            <button onclick="featureBasedLoading()" class="btn btn-primary">Feature Detection</button>
            <button onclick="errorHandlingDemo()" class="btn btn-secondary">Error Handling</button>
            
            <div id="conditional-output" class="output">
Click buttons to see how modules can be loaded conditionally!

üéØ This demonstrates real-world code splitting patterns.
            </div>
        </div>
        
        <div class="demo-section">
            <h2>‚ö° Performance Comparison</h2>
            <p>Compare loading strategies for performance optimization:</p>
            
            <div class="performance-grid">
                <div class="perf-card">
                    <span id="sequential-time" class="perf-number">0</span>
                    <div class="perf-label">Sequential Loading (ms)</div>
                </div>
                <div class="perf-card">
                    <span id="parallel-time" class="perf-number">0</span>
                    <div class="perf-label">Parallel Loading (ms)</div>
                </div>
                <div class="perf-card">
                    <span id="improvement" class="perf-number">0%</span>
                    <div class="perf-label">Performance Improvement</div>
                </div>
            </div>
            
            <button onclick="sequentialLoading()" class="btn btn-secondary">Sequential Loading</button>
            <button onclick="parallelLoading()" class="btn btn-success">Parallel Loading</button>
            <button onclick="comparePerformance()" class="btn btn-primary">Compare Both</button>
            
            <div id="performance-output" class="output">
Click "Compare Both" to see the performance difference between loading strategies!

‚ö° Parallel loading can significantly improve performance.
            </div>
        </div>
        
        <div class="demo-section">
            <h2>üèóÔ∏è Advanced Patterns</h2>
            <p>Sophisticated dynamic import patterns for real applications:</p>
            
            <button onclick="lazyLoadingPattern()" class="btn btn-success">Lazy Loading</button>
            <button onclick="moduleFactoryPattern()" class="btn btn-primary">Module Factory</button>
            <button onclick="proxyPattern()" class="btn btn-secondary">Module Proxy</button>
            <button onclick="cachingPattern()" class="btn btn-outline">Smart Caching</button>
            
            <div id="advanced-output" class="output">
Explore advanced patterns used in production applications!

üèóÔ∏è These patterns are used by frameworks like React, Vue, and Angular.
            </div>
        </div>
        
        <div class="info-box">
            <h3>üåü Dynamic Import Benefits</h3>
            <div class="comparison-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg); margin-top: var(--space-lg);">
                <div>
                    <h4>‚úÖ Advantages:</h4>
                    <ul>
                        <li><strong>Code Splitting:</strong> Only load what's needed</li>
                        <li><strong>Lazy Loading:</strong> Defer loading until required</li>
                        <li><strong>Conditional Loading:</strong> Load based on runtime conditions</li>
                        <li><strong>Bundle Size:</strong> Reduce initial bundle size</li>
                        <li><strong>Performance:</strong> Faster initial page load</li>
                        <li><strong>Memory:</strong> Lower memory usage</li>
                    </ul>
                </div>
                <div>
                    <h4>‚ö†Ô∏è Considerations:</h4>
                    <ul>
                        <li><strong>Network Requests:</strong> Additional HTTP requests</li>
                        <li><strong>Loading States:</strong> Need to handle async loading</li>
                        <li><strong>Error Handling:</strong> Network failures need handling</li>
                        <li><strong>Complexity:</strong> More complex than static imports</li>
                        <li><strong>Browser Support:</strong> Modern browsers only</li>
                        <li><strong>Debugging:</strong> Harder to debug dynamic flows</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner" style="margin: 0 auto var(--space-md) auto; width: 32px; height: 32px;"></div>
            <div>Loading modules dynamically...</div>
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill"></div>
            </div>
        </div>
    </div>

    <script type="module">
        console.log('üîÑ Dynamic Imports Demo initialized!');
        
        // Cache for loaded modules
        const moduleCache = new Map();
        
        // Performance metrics
        let performanceMetrics = {
            sequential: 0,
            parallel: 0
        };
        
        // Basic dynamic import examples
        window.basicDynamicImport = async function() {
            const output = document.getElementById('basic-output');
            output.className = 'output info';
            output.textContent = 'Loading math module dynamically...';
            
            try {
                console.time('Dynamic Import: math-utils');
                
                // Dynamic import returns a Promise
                const mathModule = await import('/esm/math-utils.js');
                
                console.timeEnd('Dynamic Import: math-utils');
                
                // Use the imported module
                const result = mathModule.add(15, 25);
                const calc = new mathModule.Calculator('Dynamic Calc');
                const calcResult = calc.calculate('multiply', 8, 7);
                
                output.className = 'output success';
                output.textContent = `‚úÖ Math Module Loaded Dynamically!

import() returned: Promise<Module>
Available exports: ${Object.keys(mathModule).join(', ')}

Testing imported functions:
‚Ä¢ add(15, 25) = ${result}
‚Ä¢ PI constant = ${mathModule.PI}
‚Ä¢ Calculator: ${calc.name}
‚Ä¢ calc.calculate('multiply', 8, 7) = ${calcResult}

üïê Loading took: ${performance.now().toFixed(2)}ms
üéØ This module was loaded on-demand, not at page load!`;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `‚ùå Dynamic import failed: ${error.message}`;
            }
        };
        
        window.loadUserService = async function() {
            const output = document.getElementById('basic-output');
            output.className = 'output info';
            output.textContent = 'Loading user service dynamically...';
            
            try {
                const userModule = await import('/esm/user-service.js');
                
                // Use default export
                const userService = new userModule.default();
                const users = userService.getAllUsers();
                
                // Use named exports
                const isValidEmail = userModule.validateEmail('test@example.com');
                const formattedUser = userModule.formatUser(users[0]);
                
                output.className = 'output success';
                output.textContent = `‚úÖ User Service Loaded Dynamically!

Default export: UserService class
Named exports: validateEmail, formatUser, ROLES

Service results:
‚Ä¢ Total users: ${users.length}
‚Ä¢ Email validation: ${isValidEmail ? '‚úÖ Valid' : '‚ùå Invalid'}
‚Ä¢ First user: ${formattedUser}
‚Ä¢ Available roles: ${Object.values(userModule.ROLES).join(', ')}

üí° Notice how both default and named exports work with dynamic imports!`;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `‚ùå Failed to load user service: ${error.message}`;
            }
        };
        
        window.loadConfigModule = async function() {
            const output = document.getElementById('basic-output');
            output.className = 'output info';
            output.textContent = 'Loading configuration module...';
            
            try {
                const configModule = await import('/esm/config.js');
                
                output.className = 'output success';
                output.textContent = `‚úÖ Config Module Loaded Dynamically!

Exports: ${Object.keys(configModule).join(', ')}

Configuration:
‚Ä¢ Environment: ${configModule.config.environment}
‚Ä¢ Version: ${configModule.getVersion()}
‚Ä¢ Production: ${configModule.isProduction()}
‚Ä¢ Development: ${configModule.isDevelopment()}
‚Ä¢ Database: ${configModule.config.database.host}:${configModule.config.database.port}

üîß Dynamic config loading enables runtime configuration!`;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `‚ùå Config loading failed: ${error.message}`;
            }
        };
        
        // Conditional loading examples
        window.conditionalImport = async function() {
            const output = document.getElementById('conditional-output');
            output.className = 'output info';
            output.textContent = 'Running smart loading logic...';
            
            try {
                let result = 'Smart Loading Results:\n\n';
                
                // Condition 1: Load based on environment
                const configModule = await import('/esm/config.js');
                if (configModule.isDevelopment()) {
                    const mathModule = await import('/esm/math-utils.js');
                    result += `üîß Development mode: Loaded math utilities\n`;
                    result += `  ‚Ä¢ Debug calculation: ${mathModule.add(10, 5)}\n`;
                } else {
                    result += `üöÄ Production mode: Math utilities not loaded\n`;
                }
                
                // Condition 2: Load based on feature flags
                if (configModule.config.features?.enableWebSockets) {
                    result += `üîå WebSockets enabled: Would load WS module\n`;
                } else {
                    result += `üì° WebSockets disabled: Module not loaded\n`;
                }
                
                // Condition 3: Load based on user capabilities
                if ('serviceWorker' in navigator) {
                    result += `‚öôÔ∏è Service Worker supported: Would load SW module\n`;
                } else {
                    result += `‚ùå Service Worker not supported: Module skipped\n`;
                }
                
                // Condition 4: Load based on screen size
                if (window.innerWidth > 768) {
                    const userModule = await import('/esm/user-service.js');
                    result += `üñ•Ô∏è Desktop detected: Loaded full user service\n`;
                    result += `  ‚Ä¢ Users available: ${userModule.default ? new userModule.default().getAllUsers().length : 'N/A'}\n`;
                } else {
                    result += `üì± Mobile detected: Using lightweight service\n`;
                }
                
                result += `\nüí° Only loaded modules that are actually needed!`;
                result += `\nüéØ This reduces bundle size and improves performance.`;
                
                output.className = 'output success';
                output.textContent = result;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `‚ùå Smart loading failed: ${error.message}`;
            }
        };
        
        // Performance comparison functions
        window.comparePerformance = async function() {
            const output = document.getElementById('performance-output');
            output.className = 'output info';
            output.textContent = 'Running comprehensive performance comparison...';
            
            try {
                // Clear previous results
                performanceMetrics = { sequential: 0, parallel: 0 };
                
                // Run sequential test
                await sequentialLoading();
                
                // Wait a bit to avoid caching interference
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Run parallel test
                await parallelLoading();
                
                // Calculate improvement
                const sequentialTime = performanceMetrics.sequential;
                const parallelTime = performanceMetrics.parallel;
                const improvementPercent = parallelTime > 0 ? (((sequentialTime / parallelTime) - 1) * 100).toFixed(0) : 0;
                
                document.getElementById('improvement').textContent = `${improvementPercent}%`;
                
                let result = `üìä Performance Comparison Complete!\n\n`;
                result += `Sequential Loading: ${sequentialTime.toFixed(2)}ms\n`;
                result += `Parallel Loading: ${parallelTime.toFixed(2)}ms\n`;
                result += `Performance Gain: ${improvementPercent}% faster\n\n`;
                result += `üí° Use parallel loading for independent modules!`;
                
                output.className = 'output success';
                output.textContent = result;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `‚ùå Performance comparison failed: ${error.message}`;
            }
        };
        
        window.sequentialLoading = async function() {
            const startTime = performance.now();
            
            await import('/esm/math-utils.js');
            await import('/esm/user-service.js');
            await import('/esm/config.js');
            
            const endTime = performance.now();
            performanceMetrics.sequential = endTime - startTime;
            document.getElementById('sequential-time').textContent = performanceMetrics.sequential.toFixed(0);
        };
        
        window.parallelLoading = async function() {
            const startTime = performance.now();
            
            const promises = [
                import('/esm/math-utils.js'),
                import('/esm/user-service.js'),
                import('/esm/config.js')
            ];
            
            await Promise.all(promises);
            
            const endTime = performance.now();
            performanceMetrics.parallel = endTime - startTime;
            document.getElementById('parallel-time').textContent = performanceMetrics.parallel.toFixed(0);
        };
        
        // Placeholder functions for other demos
        window.featureBasedLoading = async function() {
            const output = document.getElementById('conditional-output');
            output.className = 'output info';
            output.textContent = 'Feature detection and loading demo - check browser console for details!';
            
            console.log('üîç Feature Detection Demo');
            console.log('ES Modules supported:', 'noModule' in HTMLScriptElement.prototype);
            console.log('Dynamic imports working:', true); // We're using them!
            console.log('Service Worker support:', 'serviceWorker' in navigator);
        };
        
        window.errorHandlingDemo = async function() {
            const output = document.getElementById('conditional-output');
            output.className = 'output warning';
            output.textContent = 'Error handling demo - trying to load non-existent module...';
            
            try {
                await import('/non-existent-module.js');
            } catch (error) {
                output.textContent = `‚ùå Error Handling Demo:
                
Error caught: ${error.name}
Message: ${error.message}

üí° Always wrap dynamic imports in try/catch blocks!`;
            }
        };
        
        // Advanced pattern placeholders
        window.lazyLoadingPattern = async function() {
            const output = document.getElementById('advanced-output');
            output.className = 'output info';
            output.textContent = 'Lazy loading pattern demo - modules loaded only when needed!';
        };
        
        window.moduleFactoryPattern = async function() {
            const output = document.getElementById('advanced-output');
            output.className = 'output info';
            output.textContent = 'Module factory pattern - creating configured module instances!';
        };
        
        window.proxyPattern = async function() {
            const output = document.getElementById('advanced-output');
            output.className = 'output info';
            output.textContent = 'Module proxy pattern - intercepting module method calls!';
        };
        
        window.cachingPattern = async function() {
            const output = document.getElementById('advanced-output');
            output.className = 'output info';
            output.textContent = 'Smart caching pattern - optimized module loading and caching!';
        };
        
        console.log('üîÑ Dynamic Imports Demo fully loaded with professional design!');
    </script>
</body>
</html>
