<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì¶ ES Modules Browser Demo</title>
    <link rel="stylesheet" href="/browser/css/design-system.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ ES Modules Browser Demo</h1>
            <p>Real-time demonstration of ES Modules working natively in your browser</p>
        </div>
        
        <nav class="nav">
            <a href="/" class="nav-link">üè† Home</a>
            <a href="/loading-demo" class="nav-link">‚ö° Loading Demo</a>
            <a href="/dynamic-demo" class="nav-link">üîÑ Dynamic Imports</a>
            <a href="https://github.com/vishal83/JSModulesExploration" target="_blank" class="nav-link">üìö GitHub</a>
        </nav>
        
        <div class="demo-section">
            <h2>üîß Module Status <span id="main-status" class="status loading">Loading...</span></h2>
            <p>The page is loading ES modules right now. Check your browser's Network tab!</p>
            <div id="module-status" class="output info">
Initializing ES Modules demo...
Importing math utilities, user service, and configuration modules...
            </div>
        </div>
        
        <div class="demo-section">
            <h2>üßÆ Math Operations Demo</h2>
            <p>Using imported functions from math-utils.js module:</p>
            <button onclick="runMathDemo()" class="btn btn-success">Run Math Demo</button>
            <button onclick="runCalculatorDemo()" class="btn btn-primary">Test Calculator</button>
            <div id="math-output" class="output">Click "Run Math Demo" to see ES modules in action!</div>
        </div>
        
        <div class="demo-section">
            <h2>üë• User Service Demo</h2>
            <p>Using the UserService class imported as default export:</p>
            <button onclick="runUserDemo()" class="btn btn-success">Run User Demo</button>
            <button onclick="runValidationDemo()" class="btn btn-primary">Test Validation</button>
            <div id="user-output" class="output">Click "Run User Demo" to see default and named imports working!</div>
        </div>
        
        <div class="demo-section">
            <h2>‚öôÔ∏è Configuration Demo</h2>
            <p>Using named imports from configuration module:</p>
            <button onclick="runConfigDemo()" class="btn btn-success">Run Config Demo</button>
            <button onclick="runEnvironmentDemo()" class="btn btn-primary">Check Environment</button>
            <div id="config-output" class="output">Click "Run Config Demo" to see multiple named imports!</div>
        </div>
        
        <div class="demo-section">
            <h2>üîÑ Dynamic Import Demo</h2>
            <p>Loading modules dynamically at runtime:</p>
            <button onclick="runDynamicImport()" class="btn btn-success">Dynamic Import</button>
            <button onclick="runConditionalImport()" class="btn btn-primary">Conditional Import</button>
            <div id="dynamic-output" class="output">Click "Dynamic Import" to see runtime module loading!</div>
        </div>
        
        <div class="info-box">
            <h3>üåê Browser vs Node.js</h3>
            <div class="mt-4">
                <strong>Browser Environment:</strong>
                <ul>
                    <li>ES Modules work natively (no build tools needed)</li>
                    <li>Must be served over HTTP (CORS applies)</li>
                    <li>No CommonJS support (require() doesn't exist)</li>
                    <li>No __filename or __dirname</li>
                    <li>Has import.meta.url</li>
                    <li>Same-origin policy affects module loading</li>
                </ul>
            </div>
            <div class="mt-4">
                <strong>Node.js Environment:</strong>
                <ul>
                    <li>Both CommonJS and ES Modules supported</li>
                    <li>Can load from file system directly</li>
                    <li>Has __filename and __dirname (CommonJS)</li>
                    <li>No CORS restrictions</li>
                    <li>Can use require() for CommonJS modules</li>
                </ul>
            </div>
        </div>
    </div>

    <script type="module">
        // This script uses ES modules natively in the browser
        import { add, subtract, multiply, Calculator, PI, constants } from '/esm/math-utils.js';
        import UserService, { ROLES, validateEmail, formatUser } from '/esm/user-service.js';
        import { config, isProduction, isDevelopment, getVersion } from '/esm/config.js';
        
        // Update status
        document.getElementById('main-status').textContent = 'Loaded';
        document.getElementById('main-status').className = 'status success';
        
        document.getElementById('module-status').innerHTML = `‚úÖ ES Modules loaded successfully!

Imported from math-utils.js:
  ‚Ä¢ Functions: add, subtract, multiply
  ‚Ä¢ Class: Calculator
  ‚Ä¢ Constants: PI (${PI}), constants object
  
Imported from user-service.js:
  ‚Ä¢ Default export: UserService class
  ‚Ä¢ Named exports: ROLES, validateEmail, formatUser
  
Imported from config.js:
  ‚Ä¢ Configuration object and utility functions
  
üåê All modules loaded via native ES module imports!`;
        
        document.getElementById('module-status').className = 'output success';
        
        // Make functions available globally for button clicks
        window.runMathDemo = function() {
            const output = document.getElementById('math-output');
            output.className = 'output success';
            output.textContent = `üßÆ Math Operations Demo Results:

Addition: add(15, 25) = ${add(15, 25)}
Subtraction: subtract(100, 30) = ${subtract(100, 30)}
Multiplication: multiply(8, 7) = ${multiply(8, 7)}

Constants:
  œÄ = ${PI}
  Golden Ratio = ${constants.GOLDEN_RATIO}
  Speed of Light = ${constants.SPEED_OF_LIGHT.toLocaleString()} m/s

‚úÖ All functions imported and working!`;
        };
        
        window.runCalculatorDemo = function() {
            const calc = new Calculator('Browser Calculator');
            const output = document.getElementById('math-output');
            output.className = 'output success';
            
            const result1 = calc.calculate('add', 50, 25);
            const result2 = calc.calculate('multiply', 6, 9);
            const result3 = calc.calculate('divide', 144, 12);
            
            output.textContent = `üî¢ Calculator Class Demo:

Calculator Name: ${calc.name}
Operation 1: 50 + 25 = ${result1}
Operation 2: 6 √ó 9 = ${result2}  
Operation 3: 144 √∑ 12 = ${result3}

Calculator History:
${calc.getHistory().map((h, i) => `  ${i + 1}. ${h}`).join('\n')}

‚úÖ Calculator class imported and instantiated!`;
        };
        
        window.runUserDemo = function() {
            const userService = new UserService();
            const users = userService.getAllUsers();
            const output = document.getElementById('user-output');
            output.className = 'output success';
            
            // Add a new user
            const newUser = userService.addUser({
                name: 'Browser User',
                email: 'browser@example.com',
                role: ROLES.MODERATOR
            });
            
            output.textContent = `üë• User Service Demo:

Original Users:
${users.map((user, i) => `  ${i + 1}. ${formatUser(user)}`).join('\n')}

Added New User:
  ${formatUser(newUser)}

Available Roles:
  ‚Ä¢ Admin: ${ROLES.ADMIN}
  ‚Ä¢ User: ${ROLES.USER}  
  ‚Ä¢ Moderator: ${ROLES.MODERATOR}

‚úÖ Default export (UserService) and named exports working!`;
        };
        
        window.runValidationDemo = function() {
            const output = document.getElementById('user-output');
            output.className = 'output success';
            
            const email1 = 'valid@example.com';
            const email2 = 'invalid-email';
            const email3 = 'another@test.org';
            
            output.textContent = `‚úâÔ∏è Email Validation Demo:

Testing validateEmail function:
  ${email1} ‚Üí ${validateEmail(email1) ? '‚úÖ Valid' : '‚ùå Invalid'}
  ${email2} ‚Üí ${validateEmail(email2) ? '‚úÖ Valid' : '‚ùå Invalid'}
  ${email3} ‚Üí ${validateEmail(email3) ? '‚úÖ Valid' : '‚ùå Invalid'}

User Data Validation:
${JSON.stringify(UserService.validateUser({
    name: '',
    email: 'bad-email'
}), null, 2)}

‚úÖ Named export functions working perfectly!`;
        };
        
        window.runConfigDemo = function() {
            const output = document.getElementById('config-output');
            output.className = 'output success';
            output.textContent = `‚öôÔ∏è Configuration Demo:

Environment: ${config.environment}
Version: ${getVersion()}
Production Mode: ${isProduction()}
Development Mode: ${isDevelopment()}

Database Config:
  Host: ${config.database.host}
  Port: ${config.database.port}
  Name: ${config.database.name}
  SSL: ${config.database.ssl}

API Config:
  Base URL: ${config.api.baseUrl}
  Timeout: ${config.api.timeout}ms
  Retries: ${config.api.retries}

‚úÖ Multiple named imports from config module!`;
        };
        
        window.runEnvironmentDemo = function() {
            const output = document.getElementById('config-output');
            output.className = 'output info';
            output.textContent = `üåç Environment Detection:

Current Environment: ${config.environment}
Is Production: ${isProduction()}
Is Development: ${isDevelopment()}

Browser Specific:
  User Agent: ${navigator.userAgent.split(' ').slice(-2).join(' ')}
  Platform: ${navigator.platform}
  Language: ${navigator.language}
  Online: ${navigator.onLine}
  
Module Metadata:
  import.meta.url: ${import.meta.url}
  
Features Enabled:
${Object.entries(config.features).map(([key, value]) => 
  `  ‚Ä¢ ${key}: ${value ? '‚úÖ' : '‚ùå'}`
).join('\n')}`;
        };
        
        window.runDynamicImport = async function() {
            const output = document.getElementById('dynamic-output');
            output.className = 'output info';
            output.textContent = 'Loading module dynamically...';
            
            try {
                // Dynamic import in browser
                const mathModule = await import('/esm/math-utils.js');
                const configModule = await import('/esm/config.js');
                
                output.className = 'output success';
                output.textContent = `üîÑ Dynamic Import Success!

Dynamically imported math-utils.js:
  add(10, 20) = ${mathModule.add(10, 20)}
  PI = ${mathModule.PI}
  
Dynamically imported config.js:
  Version = ${configModule.getVersion()}
  Environment = ${configModule.config.environment}

üí° This demonstrates:
‚Ä¢ Runtime module loading
‚Ä¢ Code splitting potential
‚Ä¢ Lazy loading capabilities
‚Ä¢ Same module singleton behavior

‚úÖ Dynamic imports working in browser!`;
            } catch (error) {
                output.className = 'output error';
                output.textContent = `‚ùå Dynamic import failed: ${error.message}`;
            }
        };
        
        window.runConditionalImport = async function() {
            const output = document.getElementById('dynamic-output');
            output.className = 'output info';
            output.textContent = 'Running conditional import logic...';
            
            try {
                // Conditional loading based on environment
                let result = '';
                
                if (config.environment === 'development' || config.environment === 'browser') {
                    const devModule = await import('/esm/user-service.js');
                    const userService = new devModule.default();
                    result += `Development/Browser mode detected!
Loaded user service: ${userService.getAllUsers().length} users available\n`;
                }
                
                // Conditional feature loading
                if (config.features.enableCache) {
                    result += `Cache enabled - would load cache module\n`;
                }
                
                if (config.features.enableWebSockets) {
                    result += `WebSockets enabled - would load WS module\n`;
                }
                
                // Browser capability check
                if ('serviceWorker' in navigator) {
                    result += `Service Worker supported - could load SW module\n`;
                }
                
                output.className = 'output success';
                output.textContent = `üéØ Conditional Import Results:

${result}
üåê Browser Environment Detected:
  ‚Ä¢ Module support: ‚úÖ Native ES Modules
  ‚Ä¢ Dynamic imports: ‚úÖ Supported
  ‚Ä¢ Service Workers: ${'serviceWorker' in navigator ? '‚úÖ' : '‚ùå'}

üí° This shows how to:
‚Ä¢ Load modules based on conditions
‚Ä¢ Feature detection and progressive enhancement
‚Ä¢ Environment-specific module loading

‚úÖ Conditional imports completed!`;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `‚ùå Conditional import failed: ${error.message}`;
            }
        };
        
        console.log('üåê ES Modules Demo loaded successfully!');
        console.log('üì¶ Imported modules:', { 
            mathUtils: { add, subtract, Calculator, PI }, 
            userService: { UserService, ROLES, validateEmail }, 
            config: { config, isProduction, getVersion } 
        });
    </script>
</body>
</html>