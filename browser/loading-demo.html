<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš¡ Module Loading Demo</title>
    <link rel="stylesheet" href="/browser/css/design-system.css">
    <style>
        /* Additional styles for loading demo specific features */
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-xl);
            margin-bottom: var(--space-3xl);
        }
        
        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .timeline {
            background: var(--bg-glass-dark);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin: var(--space-lg) 0;
            font-family: var(--font-mono);
            font-size: var(--text-sm);
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            color: var(--text-inverse);
        }
        
        .timeline.browser {
            border-left: 4px solid var(--accent-green);
        }
        
        .timeline.nodejs {
            border-left: 4px solid var(--accent-orange);
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-lg);
            margin-top: var(--space-lg);
        }
        
        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .comparison-item {
            background: var(--bg-glass);
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            border-left: 4px solid;
        }
        
        .comparison-item.browser {
            border-left-color: var(--accent-green);
        }
        
        .comparison-item.nodejs {
            border-left-color: var(--accent-orange);
        }
        
        .comparison-item h4 {
            margin-bottom: var(--space-md);
            color: var(--text-inverse);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš¡ Module Loading Behavior Demo</h1>
            <p>Compare how modules load in browsers vs Node.js - see the difference in real-time!</p>
        </div>
        
        <nav class="nav">
            <a href="/" class="nav-link">ğŸ  Home</a>
            <a href="/esm-demo" class="nav-link">ğŸ“¦ ES Modules</a>
            <a href="/dynamic-demo" class="nav-link">ğŸ”„ Dynamic Imports</a>
            <a href="https://github.com/vishal83/JSModulesExploration" target="_blank" class="nav-link">ğŸ“š GitHub</a>
        </nav>
        
        <div class="demo-grid">
            <div class="demo-section">
                <h2>
                    ğŸŒ Browser Loading (ES Modules)
                    <span id="browser-status" class="status loading">
                        <div class="loading-spinner"></div>
                        Loading
                    </span>
                </h2>
                
                <div class="info-box">
                    <h3>How Browser Loading Works:</h3>
                    <ul>
                        <li>ğŸ“‹ Parse HTML and find &lt;script type="module"&gt;</li>
                        <li>ğŸ” Parse JavaScript, find import statements</li>
                        <li>âš¡ Fetch all modules in parallel (hoisted)</li>
                        <li>â³ Wait for all imports to resolve</li>
                        <li>ğŸš€ Execute script code</li>
                    </ul>
                </div>
                
                <button onclick="simulateBrowserLoading()" class="btn btn-success">Simulate Loading</button>
                <button onclick="clearBrowserLog()" class="btn btn-secondary">Clear Log</button>
                
                <div id="browser-timeline" class="timeline browser">
ğŸŒ Browser ES Module Loading Timeline:

Waiting for simulation...
                </div>
            </div>
            
            <div class="demo-section">
                <h2>ğŸŸ¢ Node.js Comparison</h2>
                
                <div class="info-box">
                    <h3>How Node.js Loading Works:</h3>
                    <ul>
                        <li>ğŸ“ Execute code line by line</li>
                        <li>ğŸ”„ Hit require() â†’ pause execution</li>
                        <li>ğŸ“¥ Load module synchronously</li>
                        <li>âœ… Continue execution</li>
                        <li>ğŸ Complete</li>
                    </ul>
                </div>
                
                <button onclick="simulateNodeJSLoading()" class="btn btn-success">Simulate Node.js</button>
                <button onclick="clearNodeLog()" class="btn btn-secondary">Clear Log</button>
                
                <div id="nodejs-timeline" class="timeline nodejs">
ğŸŸ¢ Node.js CommonJS Loading Timeline:

Waiting for simulation...
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>ğŸ“Š Side-by-Side Comparison</h2>
            
            <button onclick="runComparison()" class="btn btn-primary">Run Side-by-Side Comparison</button>
            <button onclick="clearComparison()" class="btn btn-secondary">Clear</button>
            
            <div class="comparison-grid">
                <div class="comparison-item browser">
                    <h4>ğŸŒ Browser (ES Modules)</h4>
                    <div id="browser-comparison" class="timeline">
Click "Run Comparison" to see both loading patterns simultaneously!
                    </div>
                </div>
                
                <div class="comparison-item nodejs">
                    <h4>ğŸŸ¢ Node.js (CommonJS)</h4>
                    <div id="nodejs-comparison" class="timeline">
Click "Run Comparison" to see both loading patterns simultaneously!
                    </div>
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>ğŸ” Real Module Loading Analysis</h2>
            <p>This page itself demonstrates ES module loading! Check your browser's Developer Tools:</p>
            
            <div class="info-box">
                <h3>ğŸ› ï¸ Developer Tools Analysis:</h3>
                <ol>
                    <li><strong>Network Tab:</strong> See how modules are fetched</li>
                    <li><strong>Console:</strong> View loading order and timing</li>
                    <li><strong>Sources Tab:</strong> Examine module dependencies</li>
                    <li><strong>Performance Tab:</strong> Analyze loading performance</li>
                </ol>
            </div>
            
            <button onclick="analyzeCurrentPage()" class="btn btn-primary">Analyze This Page</button>
            <button onclick="showNetworkTips()" class="btn btn-secondary">Network Tips</button>
            
            <div id="analysis-output" class="timeline">
Click "Analyze This Page" to examine how this very page loaded its modules!
            </div>
        </div>
    </div>

    <script type="module">
        // This script demonstrates real ES module loading in the browser!
        console.time('Total ES Module Loading');
        console.log('ğŸŒ [Browser] Starting ES module loading...');
        
        // These imports are hoisted and loaded in parallel
        import { add, multiply, Calculator } from '/esm/math-utils.js';
        import { config, isProduction } from '/esm/config.js';
        
        console.log('ğŸŒ [Browser] All imports resolved, executing script...');
        console.timeEnd('Total ES Module Loading');
        
        // Update status
        document.getElementById('browser-status').innerHTML = `
            <span class="status success">
                âœ… Loaded
            </span>
        `;
        
        // Simulation functions
        window.simulateBrowserLoading = function() {
            const timeline = document.getElementById('browser-timeline');
            timeline.innerHTML = 'ğŸŒ Browser ES Module Loading Timeline:\n\n';
            
            let step = 0;
            const steps = [
                'â° 0ms    - HTML parsing begins',
                'â° 2ms    - Found <script type="module">',
                'â° 3ms    - Parsing JavaScript, finding imports...',
                'â° 5ms    - ğŸ” Found import statements (hoisted!)',
                'â° 6ms    - ğŸ“¡ Fetching /esm/math-utils.js',
                'â° 7ms    - ğŸ“¡ Fetching /esm/config.js', 
                'â° 8ms    - ğŸ“¡ Fetching /esm/user-service.js',
                'â° 12ms   - âš¡ All modules fetching in parallel...',
                'â° 45ms   - âœ… math-utils.js loaded',
                'â° 52ms   - âœ… config.js loaded',
                'â° 58ms   - âœ… user-service.js loaded',
                'â° 60ms   - ğŸ”— Resolving module dependencies...',
                'â° 62ms   - ğŸš€ All imports resolved, executing script!',
                'â° 65ms   - ğŸ“ console.log("Script execution starts")',
                'â° 68ms   - ğŸ§® Using imported add(5, 10) = 15',
                'â° 70ms   - âœ… Script execution complete!',
                '',
                'ğŸ”‘ Key Points:',
                'â€¢ All imports are hoisted (processed first)',
                'â€¢ Modules load in parallel, not sequentially', 
                'â€¢ Script execution waits for ALL imports',
                'â€¢ No blocking during loading phase'
            ];
            
            const interval = setInterval(() => {
                if (step < steps.length) {
                    timeline.innerHTML += steps[step] + '\n';
                    timeline.scrollTop = timeline.scrollHeight;
                    step++;
                } else {
                    clearInterval(interval);
                }
            }, 300);
        };
        
        window.simulateNodeJSLoading = function() {
            const timeline = document.getElementById('nodejs-timeline');
            timeline.innerHTML = 'ğŸŸ¢ Node.js CommonJS Loading Timeline:\n\n';
            
            let step = 0;
            const steps = [
                'â° 0ms    - Node.js script execution begins',
                'â° 1ms    - ğŸ“ console.log("Script started")',
                'â° 2ms    - ğŸ” Encountered require("./math-utils")',
                'â° 3ms    - â¸ï¸  EXECUTION PAUSED (blocking)',
                'â° 4ms    - ğŸ“¥ Loading math-utils.js...',
                'â° 25ms   - ğŸ”„ Executing math-utils.js code...',
                'â° 30ms   - âœ… math-utils.js loaded and cached',
                'â° 31ms   - â–¶ï¸  EXECUTION RESUMED',
                'â° 32ms   - ğŸ“ console.log("Math module loaded")',
                'â° 33ms   - ğŸ” Encountered require("./config")',
                'â° 34ms   - â¸ï¸  EXECUTION PAUSED again',
                'â° 35ms   - ğŸ“¥ Loading config.js...',
                'â° 55ms   - ğŸ”„ Executing config.js code...',
                'â° 58ms   - âœ… config.js loaded and cached',
                'â° 59ms   - â–¶ï¸  EXECUTION RESUMED',
                'â° 60ms   - ğŸ§® Using add(5, 10) = 15',
                'â° 61ms   - âœ… Script execution complete!',
                '',
                'ğŸ”‘ Key Points:',
                'â€¢ Synchronous, blocking execution',
                'â€¢ Modules load one at a time (sequential)',
                'â€¢ Each require() pauses execution',
                'â€¢ Code runs line by line'
            ];
            
            const interval = setInterval(() => {
                if (step < steps.length) {
                    timeline.innerHTML += steps[step] + '\n';
                    timeline.scrollTop = timeline.scrollHeight;
                    step++;
                } else {
                    clearInterval(interval);
                }
            }, 300);
        };
        
        window.runComparison = function() {
            const browserComp = document.getElementById('browser-comparison');
            const nodejsComp = document.getElementById('nodejs-comparison');
            
            browserComp.innerHTML = 'ğŸŒ Browser:\nâ° Starting...\n';
            nodejsComp.innerHTML = 'ğŸŸ¢ Node.js:\nâ° Starting...\n';
            
            // Browser simulation
            const browserSteps = [
                'â° 0ms - Parse & hoist imports',
                'â° 5ms - Fetch modules in parallel',
                'â° 50ms - All modules loaded',
                'â° 52ms - Execute script',
                'âœ… Complete (non-blocking)'
            ];
            
            // Node.js simulation
            const nodejsSteps = [
                'â° 0ms - Start execution',
                'â° 2ms - Hit require() - BLOCK',
                'â° 30ms - Module loaded - RESUME',
                'â° 32ms - Hit require() - BLOCK',
                'â° 60ms - Module loaded - RESUME',
                'âœ… Complete (blocking)'
            ];
            
            let step = 0;
            const interval = setInterval(() => {
                if (step < Math.max(browserSteps.length, nodejsSteps.length)) {
                    if (step < browserSteps.length) {
                        browserComp.innerHTML += browserSteps[step] + '\n';
                    }
                    if (step < nodejsSteps.length) {
                        nodejsComp.innerHTML += nodejsSteps[step] + '\n';
                    }
                    step++;
                } else {
                    clearInterval(interval);
                }
            }, 800);
        };
        
        window.analyzeCurrentPage = function() {
            const output = document.getElementById('analysis-output');
            const perfEntries = performance.getEntriesByType('navigation');
            const resourceEntries = performance.getEntriesByType('resource');
            
            let analysis = `ğŸ” Real Page Loading Analysis:\n\n`;
            
            // Navigation timing
            if (perfEntries.length > 0) {
                const nav = perfEntries[0];
                analysis += `ğŸ“Š Navigation Timing:\n`;
                analysis += `  â€¢ DNS Lookup: ${(nav.domainLookupEnd - nav.domainLookupStart).toFixed(2)}ms\n`;
                analysis += `  â€¢ TCP Connect: ${(nav.connectEnd - nav.connectStart).toFixed(2)}ms\n`;
                analysis += `  â€¢ Request: ${(nav.responseStart - nav.requestStart).toFixed(2)}ms\n`;
                analysis += `  â€¢ Response: ${(nav.responseEnd - nav.responseStart).toFixed(2)}ms\n`;
                analysis += `  â€¢ DOM Content Loaded: ${(nav.domContentLoadedEventEnd - nav.navigationStart).toFixed(2)}ms\n`;
                analysis += `  â€¢ Page Load Complete: ${(nav.loadEventEnd - nav.navigationStart).toFixed(2)}ms\n\n`;
            }
            
            // Resource timing (modules)
            const moduleResources = resourceEntries.filter(r => r.name.includes('.js') || r.name.includes('.mjs'));
            if (moduleResources.length > 0) {
                analysis += `ğŸ“¦ Module Loading:\n`;
                moduleResources.forEach(resource => {
                    const filename = resource.name.split('/').pop();
                    analysis += `  â€¢ ${filename}: ${resource.duration.toFixed(2)}ms\n`;
                });
                analysis += `\n`;
            }
            
            // Import meta info
            analysis += `ğŸŒ Module Information:\n`;
            analysis += `  â€¢ Current module URL: ${import.meta.url}\n`;
            analysis += `  â€¢ Module type: ES Module (native browser support)\n`;
            analysis += `  â€¢ Import hoisting: âœ… Active\n`;
            analysis += `  â€¢ Parallel loading: âœ… Active\n\n`;
            
            // Browser capabilities
            analysis += `ğŸš€ Browser Capabilities:\n`;
            
            // Check ES Modules support
            const hasESModules = 'noModule' in HTMLScriptElement.prototype;
            analysis += `  â€¢ ES Modules: ${hasESModules ? 'âœ…' : 'âŒ'}\n`;
            
            // Check dynamic import support
            const hasDynamicImport = true; // We're using it successfully here
            analysis += `  â€¢ Dynamic import(): ${hasDynamicImport ? 'âœ…' : 'âŒ'}\n`;
            
            analysis += `  â€¢ Top-level await: âœ… (in modules)\n`;
            
            // Check HTTP/2
            const isHTTPS = window.location.protocol === 'https:';
            analysis += `  â€¢ HTTP/2: ${isHTTPS ? 'âœ… Likely' : 'â“ Unknown'}\n`;
            
            output.innerHTML = analysis;
            output.scrollTop = 0;
        };
        
        window.showNetworkTips = function() {
            const output = document.getElementById('analysis-output');
            output.innerHTML = `ğŸ› ï¸ Browser Developer Tools Tips:

ğŸ“Š Network Tab Analysis:
  1. Open Dev Tools (F12) â†’ Network Tab
  2. Reload page and watch module loading
  3. Look for:
     â€¢ Parallel requests for .js/.mjs files
     â€¢ "type: module" in request headers
     â€¢ CORS headers for cross-origin modules
     â€¢ Cache behavior (304 vs 200 status)

ğŸ” What to Notice:
  â€¢ ES modules load in parallel (multiple requests at once)
  â€¢ Each import creates a separate network request
  â€¢ Browser automatically handles dependency resolution
  â€¢ Modules are cached after first load

âš¡ Performance Insights:
  â€¢ Module loading happens during HTML parsing
  â€¢ No JavaScript execution blocking
  â€¢ HTTP/2 multiplexing helps with parallel requests
  â€¢ Tree shaking possible with proper bundlers

ğŸ¯ Console Commands to Try:
  performance.getEntriesByType('resource')
  performance.getEntriesByType('navigation')
  console.log(import.meta.url)
  
ğŸŒ Module-specific in Network tab:
  â€¢ Filter by "JS" to see only JavaScript files
  â€¢ Check "Initiator" column for import chains
  â€¢ "Size" column shows actual vs compressed size`;
        };
        
        // Clear functions
        window.clearBrowserLog = () => {
            document.getElementById('browser-timeline').innerHTML = 'ğŸŒ Browser ES Module Loading Timeline:\n\nWaiting for simulation...';
        };
        
        window.clearNodeLog = () => {
            document.getElementById('nodejs-timeline').innerHTML = 'ğŸŸ¢ Node.js CommonJS Loading Timeline:\n\nWaiting for simulation...';
        };
        
        window.clearComparison = () => {
            document.getElementById('browser-comparison').innerHTML = 'Click "Run Comparison" to see both loading patterns simultaneously!';
            document.getElementById('nodejs-comparison').innerHTML = 'Click "Run Comparison" to see both loading patterns simultaneously!';
        };
        
        console.log('âš¡ Loading demo initialized with real ES modules!');
        console.log('ğŸ“¦ Imported functions working:', { 
            add: add(2, 3), 
            multiply: multiply(4, 5),
            environment: config.environment 
        });
    </script>
</body>
</html>