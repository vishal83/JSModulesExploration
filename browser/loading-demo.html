<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° Module Loading Demo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, monospace;
            background: #0d1117;
            color: #e6edf3;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #1f2937, #374151);
            border-radius: 12px;
            border: 1px solid #374151;
        }
        
        .header h1 {
            color: #fbbf24;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .nav {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .nav a {
            display: inline-block;
            margin: 0 10px;
            padding: 12px 24px;
            background: #1f2937;
            color: #e6edf3;
            text-decoration: none;
            border-radius: 6px;
            border: 1px solid #374151;
            transition: all 0.3s;
        }
        
        .nav a:hover {
            background: #374151;
            border-color: #4b5563;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .demo-section {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 25px;
            position: relative;
        }
        
        .demo-section h2 {
            color: #58a6ff;
            margin-bottom: 15px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .loading-indicator {
            width: 12px;
            height: 12px;
            border: 2px solid #30363d;
            border-top: 2px solid #58a6ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .timeline {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'SF Mono', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.4;
            white-space: pre-wrap;
            position: relative;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: linear-gradient(to bottom, #0d1117, transparent);
            pointer-events: none;
            z-index: 1;
        }
        
        .timeline.browser {
            border-left: 4px solid #22c55e;
        }
        
        .timeline.comparison {
            border-left: 4px solid #f59e0b;
        }
        
        button {
            background: linear-gradient(135deg, #238636, #2ea043);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-right: 15px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: linear-gradient(135deg, #2ea043, #238636);
            transform: translateY(-1px);
        }
        
        button:disabled {
            background: #6e7681;
            cursor: not-allowed;
            transform: none;
        }
        
        button.secondary {
            background: linear-gradient(135deg, #6e7681, #7d8590);
        }
        
        button.secondary:hover {
            background: linear-gradient(135deg, #7d8590, #8b949e);
        }
        
        .info-box {
            background: #0969da;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #2188ff;
        }
        
        .info-box h3 {
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .comparison-box {
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        
        .comparison-item {
            background: #0d1117;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid;
        }
        
        .comparison-item.browser {
            border-left-color: #22c55e;
        }
        
        .comparison-item.nodejs {
            border-left-color: #f59e0b;
        }
        
        .comparison-item h4 {
            margin-bottom: 10px;
            color: #58a6ff;
        }
        
        .status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status.loaded {
            background: #1a472a;
            color: #7ce38b;
        }
        
        .status.loading {
            background: #7c2d12;
            color: #fed7aa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° Module Loading Behavior Demo</h1>
            <p>Compare how modules load in browsers vs Node.js - see the difference in real-time!</p>
        </div>
        
        <div class="nav">
            <a href="/">üè† Home</a>
            <a href="/esm-demo">üì¶ ES Modules</a>
            <a href="/dynamic-demo">üîÑ Dynamic Imports</a>
            <a href="https://github.com/vishal83/JSModulesExploration" target="_blank">üìö GitHub</a>
        </div>
        
        <div class="demo-grid">
            <div class="demo-section">
                <h2>
                    üåê Browser Loading (ES Modules)
                    <span id="browser-status" class="status loading">
                        <div class="loading-indicator"></div>
                        Loading
                    </span>
                </h2>
                
                <div class="info-box">
                    <h3>How Browser Loading Works:</h3>
                    <ul>
                        <li>üìã Parse HTML and find &lt;script type="module"&gt;</li>
                        <li>üîç Parse JavaScript, find import statements</li>
                        <li>‚ö° Fetch all modules in parallel (hoisted)</li>
                        <li>‚è≥ Wait for all imports to resolve</li>
                        <li>üöÄ Execute script code</li>
                    </ul>
                </div>
                
                <button onclick="simulateBrowserLoading()">Simulate Loading</button>
                <button onclick="clearBrowserLog()" class="secondary">Clear Log</button>
                
                <div id="browser-timeline" class="timeline browser">
üåê Browser ES Module Loading Timeline:

Waiting for simulation...
                </div>
            </div>
            
            <div class="demo-section">
                <h2>üü¢ Node.js Comparison</h2>
                
                <div class="info-box">
                    <h3>How Node.js Loading Works:</h3>
                    <ul>
                        <li>üìù Execute code line by line</li>
                        <li>üîÑ Hit require() ‚Üí pause execution</li>
                        <li>üì• Load module synchronously</li>
                        <li>‚úÖ Continue execution</li>
                        <li>üèÅ Complete</li>
                    </ul>
                </div>
                
                <button onclick="simulateNodeJSLoading()">Simulate Node.js</button>
                <button onclick="clearNodeLog()" class="secondary">Clear Log</button>
                
                <div id="nodejs-timeline" class="timeline">
üü¢ Node.js CommonJS Loading Timeline:

Waiting for simulation...
                </div>
            </div>
        </div>
        
        <div class="comparison-box">
            <h2 style="color: #58a6ff; margin-bottom: 20px;">üìä Side-by-Side Comparison</h2>
            
            <button onclick="runComparison()">Run Side-by-Side Comparison</button>
            <button onclick="clearComparison()" class="secondary">Clear</button>
            
            <div class="comparison-grid">
                <div class="comparison-item browser">
                    <h4>üåê Browser (ES Modules)</h4>
                    <div id="browser-comparison" class="timeline">
Click "Run Comparison" to see both loading patterns simultaneously!
                    </div>
                </div>
                
                <div class="comparison-item nodejs">
                    <h4>üü¢ Node.js (CommonJS)</h4>
                    <div id="nodejs-comparison" class="timeline">
Click "Run Comparison" to see both loading patterns simultaneously!
                    </div>
                </div>
            </div>
        </div>
        
        <div class="demo-section" style="margin-top: 30px;">
            <h2>üîç Real Module Loading Analysis</h2>
            <p>This page itself demonstrates ES module loading! Check your browser's Developer Tools:</p>
            
            <div class="info-box">
                <h3>üõ†Ô∏è Developer Tools Analysis:</h3>
                <ol>
                    <li><strong>Network Tab:</strong> See how modules are fetched</li>
                    <li><strong>Console:</strong> View loading order and timing</li>
                    <li><strong>Sources Tab:</strong> Examine module dependencies</li>
                    <li><strong>Performance Tab:</strong> Analyze loading performance</li>
                </ol>
            </div>
            
            <button onclick="analyzeCurrentPage()">Analyze This Page</button>
            <button onclick="showNetworkTips()">Network Tips</button>
            
            <div id="analysis-output" class="timeline comparison">
Click "Analyze This Page" to examine how this very page loaded its modules!
            </div>
        </div>
    </div>

    <script type="module">
        // This script demonstrates real ES module loading in the browser!
        console.time('Total ES Module Loading');
        console.log('üåê [Browser] Starting ES module loading...');
        
        // These imports are hoisted and loaded in parallel
        import { add, multiply, Calculator } from '/esm/math-utils.js';
        import { config, isProduction } from '/esm/config.js';
        
        console.log('üåê [Browser] All imports resolved, executing script...');
        console.timeEnd('Total ES Module Loading');
        
        // Update status
        document.getElementById('browser-status').innerHTML = `
            <span style="background: #1a472a; color: #7ce38b; padding: 2px 6px; border-radius: 3px;">
                ‚úÖ Loaded
            </span>
        `;
        
        // Simulation functions
        window.simulateBrowserLoading = function() {
            const timeline = document.getElementById('browser-timeline');
            timeline.innerHTML = 'üåê Browser ES Module Loading Timeline:\n\n';
            
            let step = 0;
            const steps = [
                '‚è∞ 0ms    - HTML parsing begins',
                '‚è∞ 2ms    - Found <script type="module">',
                '‚è∞ 3ms    - Parsing JavaScript, finding imports...',
                '‚è∞ 5ms    - üîç Found import statements (hoisted!)',
                '‚è∞ 6ms    - üì° Fetching /esm/math-utils.js',
                '‚è∞ 7ms    - üì° Fetching /esm/config.js', 
                '‚è∞ 8ms    - üì° Fetching /esm/user-service.js',
                '‚è∞ 12ms   - ‚ö° All modules fetching in parallel...',
                '‚è∞ 45ms   - ‚úÖ math-utils.js loaded',
                '‚è∞ 52ms   - ‚úÖ config.js loaded',
                '‚è∞ 58ms   - ‚úÖ user-service.js loaded',
                '‚è∞ 60ms   - üîó Resolving module dependencies...',
                '‚è∞ 62ms   - üöÄ All imports resolved, executing script!',
                '‚è∞ 65ms   - üìù console.log("Script execution starts")',
                '‚è∞ 68ms   - üßÆ Using imported add(5, 10) = 15',
                '‚è∞ 70ms   - ‚úÖ Script execution complete!',
                '',
                'üîë Key Points:',
                '‚Ä¢ All imports are hoisted (processed first)',
                '‚Ä¢ Modules load in parallel, not sequentially', 
                '‚Ä¢ Script execution waits for ALL imports',
                '‚Ä¢ No blocking during loading phase'
            ];
            
            const interval = setInterval(() => {
                if (step < steps.length) {
                    timeline.innerHTML += steps[step] + '\n';
                    timeline.scrollTop = timeline.scrollHeight;
                    step++;
                } else {
                    clearInterval(interval);
                }
            }, 300);
        };
        
        window.simulateNodeJSLoading = function() {
            const timeline = document.getElementById('nodejs-timeline');
            timeline.innerHTML = 'üü¢ Node.js CommonJS Loading Timeline:\n\n';
            
            let step = 0;
            const steps = [
                '‚è∞ 0ms    - Node.js script execution begins',
                '‚è∞ 1ms    - üìù console.log("Script started")',
                '‚è∞ 2ms    - üîç Encountered require("./math-utils")',
                '‚è∞ 3ms    - ‚è∏Ô∏è  EXECUTION PAUSED (blocking)',
                '‚è∞ 4ms    - üì• Loading math-utils.js...',
                '‚è∞ 25ms   - üîÑ Executing math-utils.js code...',
                '‚è∞ 30ms   - ‚úÖ math-utils.js loaded and cached',
                '‚è∞ 31ms   - ‚ñ∂Ô∏è  EXECUTION RESUMED',
                '‚è∞ 32ms   - üìù console.log("Math module loaded")',
                '‚è∞ 33ms   - üîç Encountered require("./config")',
                '‚è∞ 34ms   - ‚è∏Ô∏è  EXECUTION PAUSED again',
                '‚è∞ 35ms   - üì• Loading config.js...',
                '‚è∞ 55ms   - üîÑ Executing config.js code...',
                '‚è∞ 58ms   - ‚úÖ config.js loaded and cached',
                '‚è∞ 59ms   - ‚ñ∂Ô∏è  EXECUTION RESUMED',
                '‚è∞ 60ms   - üßÆ Using add(5, 10) = 15',
                '‚è∞ 61ms   - ‚úÖ Script execution complete!',
                '',
                'üîë Key Points:',
                '‚Ä¢ Synchronous, blocking execution',
                '‚Ä¢ Modules load one at a time (sequential)',
                '‚Ä¢ Each require() pauses execution',
                '‚Ä¢ Code runs line by line'
            ];
            
            const interval = setInterval(() => {
                if (step < steps.length) {
                    timeline.innerHTML += steps[step] + '\n';
                    timeline.scrollTop = timeline.scrollHeight;
                    step++;
                } else {
                    clearInterval(interval);
                }
            }, 300);
        };
        
        window.runComparison = function() {
            const browserComp = document.getElementById('browser-comparison');
            const nodejsComp = document.getElementById('nodejs-comparison');
            
            browserComp.innerHTML = 'üåê Browser:\n‚è∞ Starting...\n';
            nodejsComp.innerHTML = 'üü¢ Node.js:\n‚è∞ Starting...\n';
            
            // Browser simulation
            const browserSteps = [
                '‚è∞ 0ms - Parse & hoist imports',
                '‚è∞ 5ms - Fetch modules in parallel',
                '‚è∞ 50ms - All modules loaded',
                '‚è∞ 52ms - Execute script',
                '‚úÖ Complete (non-blocking)'
            ];
            
            // Node.js simulation
            const nodejsSteps = [
                '‚è∞ 0ms - Start execution',
                '‚è∞ 2ms - Hit require() - BLOCK',
                '‚è∞ 30ms - Module loaded - RESUME',
                '‚è∞ 32ms - Hit require() - BLOCK',
                '‚è∞ 60ms - Module loaded - RESUME',
                '‚úÖ Complete (blocking)'
            ];
            
            let step = 0;
            const interval = setInterval(() => {
                if (step < Math.max(browserSteps.length, nodejsSteps.length)) {
                    if (step < browserSteps.length) {
                        browserComp.innerHTML += browserSteps[step] + '\n';
                    }
                    if (step < nodejsSteps.length) {
                        nodejsComp.innerHTML += nodejsSteps[step] + '\n';
                    }
                    step++;
                } else {
                    clearInterval(interval);
                }
            }, 800);
        };
        
        window.analyzeCurrentPage = function() {
            const output = document.getElementById('analysis-output');
            const perfEntries = performance.getEntriesByType('navigation');
            const resourceEntries = performance.getEntriesByType('resource');
            
            let analysis = `üîç Real Page Loading Analysis:\n\n`;
            
            // Navigation timing
            if (perfEntries.length > 0) {
                const nav = perfEntries[0];
                analysis += `üìä Navigation Timing:\n`;
                analysis += `  ‚Ä¢ DNS Lookup: ${(nav.domainLookupEnd - nav.domainLookupStart).toFixed(2)}ms\n`;
                analysis += `  ‚Ä¢ TCP Connect: ${(nav.connectEnd - nav.connectStart).toFixed(2)}ms\n`;
                analysis += `  ‚Ä¢ Request: ${(nav.responseStart - nav.requestStart).toFixed(2)}ms\n`;
                analysis += `  ‚Ä¢ Response: ${(nav.responseEnd - nav.responseStart).toFixed(2)}ms\n`;
                analysis += `  ‚Ä¢ DOM Content Loaded: ${(nav.domContentLoadedEventEnd - nav.navigationStart).toFixed(2)}ms\n`;
                analysis += `  ‚Ä¢ Page Load Complete: ${(nav.loadEventEnd - nav.navigationStart).toFixed(2)}ms\n\n`;
            }
            
            // Resource timing (modules)
            const moduleResources = resourceEntries.filter(r => r.name.includes('.js') || r.name.includes('.mjs'));
            if (moduleResources.length > 0) {
                analysis += `üì¶ Module Loading:\n`;
                moduleResources.forEach(resource => {
                    const filename = resource.name.split('/').pop();
                    analysis += `  ‚Ä¢ ${filename}: ${resource.duration.toFixed(2)}ms\n`;
                });
                analysis += `\n`;
            }
            
            // Import meta info
            analysis += `üåê Module Information:\n`;
            analysis += `  ‚Ä¢ Current module URL: ${import.meta.url}\n`;
            analysis += `  ‚Ä¢ Module type: ES Module (native browser support)\n`;
            analysis += `  ‚Ä¢ Import hoisting: ‚úÖ Active\n`;
            analysis += `  ‚Ä¢ Parallel loading: ‚úÖ Active\n\n`;
            
            // Browser capabilities
            analysis += `üöÄ Browser Capabilities:\n`;
            analysis += `  ‚Ä¢ ES Modules: ${'noModule' in HTMLScriptElement.prototype ? '‚úÖ' : '‚ùå'}\n`;
            analysis += `  ‚Ä¢ Dynamic import(): ${typeof import === 'function' ? '‚úÖ' : '‚ùå'}\n`;
            analysis += `  ‚Ä¢ Top-level await: ‚úÖ (in modules)\n`;
            analysis += `  ‚Ä¢ HTTP/2: ${window.location.protocol === 'https:' ? '‚úÖ Likely' : '‚ùì Unknown'}\n`;
            
            output.innerHTML = analysis;
            output.scrollTop = 0;
        };
        
        window.showNetworkTips = function() {
            const output = document.getElementById('analysis-output');
            output.innerHTML = `üõ†Ô∏è Browser Developer Tools Tips:

üìä Network Tab Analysis:
  1. Open Dev Tools (F12) ‚Üí Network Tab
  2. Reload page and watch module loading
  3. Look for:
     ‚Ä¢ Parallel requests for .js/.mjs files
     ‚Ä¢ "type: module" in request headers
     ‚Ä¢ CORS headers for cross-origin modules
     ‚Ä¢ Cache behavior (304 vs 200 status)

üîç What to Notice:
  ‚Ä¢ ES modules load in parallel (multiple requests at once)
  ‚Ä¢ Each import creates a separate network request
  ‚Ä¢ Browser automatically handles dependency resolution
  ‚Ä¢ Modules are cached after first load

‚ö° Performance Insights:
  ‚Ä¢ Module loading happens during HTML parsing
  ‚Ä¢ No JavaScript execution blocking
  ‚Ä¢ HTTP/2 multiplexing helps with parallel requests
  ‚Ä¢ Tree shaking possible with proper bundlers

üéØ Console Commands to Try:
  performance.getEntriesByType('resource')
  performance.getEntriesByType('navigation')
  console.log(import.meta.url)
  
üåê Module-specific in Network tab:
  ‚Ä¢ Filter by "JS" to see only JavaScript files
  ‚Ä¢ Check "Initiator" column for import chains
  ‚Ä¢ "Size" column shows actual vs compressed size`;
        };
        
        // Clear functions
        window.clearBrowserLog = () => {
            document.getElementById('browser-timeline').innerHTML = 'üåê Browser ES Module Loading Timeline:\n\nWaiting for simulation...';
        };
        
        window.clearNodeLog = () => {
            document.getElementById('nodejs-timeline').innerHTML = 'üü¢ Node.js CommonJS Loading Timeline:\n\nWaiting for simulation...';
        };
        
        window.clearComparison = () => {
            document.getElementById('browser-comparison').innerHTML = 'Click "Run Comparison" to see both loading patterns simultaneously!';
            document.getElementById('nodejs-comparison').innerHTML = 'Click "Run Comparison" to see both loading patterns simultaneously!';
        };
        
        console.log('‚ö° Loading demo initialized with real ES modules!');
        console.log('üì¶ Imported functions working:', { 
            add: add(2, 3), 
            multiply: multiply(4, 5),
            environment: config.environment 
        });
    </script>
</body>
</html>
