<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔧 ES Modules Debug</title>
    <link rel="stylesheet" href="/browser/css/design-system.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔧 ES Modules Debug Tool</h1>
            <p>Debug and test ES module loading behavior in your browser</p>
        </div>
        
        <nav class="nav">
            <a href="/" class="nav-link">🏠 Home</a>
            <a href="/esm-demo" class="nav-link">📦 ES Modules</a>
            <a href="/loading-demo" class="nav-link">⚡ Loading Demo</a>
            <a href="https://github.com/vishal83/JSModulesExploration" target="_blank" class="nav-link">📚 GitHub</a>
        </nav>
        
        <div class="demo-section">
            <h2>🚀 Module Loading Tests</h2>
            <p>Test individual module loading and inspect the results:</p>
            
            <button onclick="testMathModule()" class="btn btn-primary">Test Math Module</button>
            <button onclick="testUserModule()" class="btn btn-success">Test User Module</button>
            <button onclick="testConfigModule()" class="btn btn-secondary">Test Config Module</button>
            <button onclick="testAllModules()" class="btn btn-outline">Test All Modules</button>
            
            <div id="debug-output" class="output">
🔧 Debug Tool Ready!

Click any button above to test module loading and inspect the results.
This tool will show detailed information about module imports and exports.
            </div>
        </div>
        
        <div class="demo-section">
            <h2>🔍 Browser Environment Analysis</h2>
            <p>Analyze browser capabilities and module support:</p>
            
            <button onclick="analyzeBrowserCapabilities()" class="btn btn-primary">Analyze Browser</button>
            <button onclick="testModuleFeatures()" class="btn btn-success">Test Module Features</button>
            <button onclick="clearDebugOutput()" class="btn btn-secondary">Clear Output</button>
            
            <div id="browser-analysis" class="output">
Click "Analyze Browser" to see detailed browser capability analysis!
            </div>
        </div>
        
        <div class="info-box">
            <h3>🛠️ Debug Features</h3>
            <ul>
                <li><strong>Module Loading:</strong> Test individual module imports</li>
                <li><strong>Browser Analysis:</strong> Check ES module support and capabilities</li>
                <li><strong>Error Handling:</strong> See detailed error information</li>
                <li><strong>Performance:</strong> Measure module loading times</li>
                <li><strong>Network Inspection:</strong> Analyze HTTP requests</li>
            </ul>
        </div>
    </div>
    
    <script type="module">
        console.log('🔧 Debug tool initialized');
        
        window.testMathModule = async function() {
            const output = document.getElementById('debug-output');
            output.className = 'output info';
            output.textContent = '🔧 Testing math module...';
            
            try {
                console.time('Math Module Load');
                const mathModule = await import('/esm/math-utils.js');
                console.timeEnd('Math Module Load');
                
                output.className = 'output success';
                output.textContent = `✅ Math Module Debug Results:

🔍 Module Analysis:
  • Import successful: ✅
  • Module type: ${typeof mathModule}
  • Exports found: ${Object.keys(mathModule).length}
  • Export names: ${Object.keys(mathModule).join(', ')}

🧮 Function Tests:
  • add(10, 5) = ${mathModule.add(10, 5)}
  • multiply(3, 7) = ${mathModule.multiply(3, 7)}
  • PI constant = ${mathModule.PI}
  • E constant = ${mathModule.E}

🏗️ Constructor Tests:
  • Calculator available: ${typeof mathModule.Calculator === 'function' ? '✅' : '❌'}
  • Calculator instance: ${mathModule.Calculator ? new mathModule.Calculator('Debug').name : 'N/A'}

📊 Performance:
  • Check console for loading time
  • Module cached: ${performance.getEntriesByName('/esm/math-utils.js').length > 0}`;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `❌ Math module test failed:
                
Error: ${error.name}
Message: ${error.message}
Stack: ${error.stack}

Debug info:
  • Module path: /esm/math-utils.js
  • Import type: dynamic import()
  • Browser support: ${typeof import !== 'undefined' ? '✅' : '❌'}`;
            }
        };
        
        window.testUserModule = async function() {
            const output = document.getElementById('debug-output');
            output.className = 'output info';
            output.textContent = '🔧 Testing user service module...';
            
            try {
                const userModule = await import('/esm/user-service.js');
                const userService = new userModule.default();
                
                output.className = 'output success';
                output.textContent = `✅ User Service Module Debug Results:

🔍 Module Analysis:
  • Default export: ${typeof userModule.default}
  • Named exports: ${Object.keys(userModule).filter(key => key !== 'default').join(', ')}
  
👥 Service Tests:
  • UserService instantiated: ✅
  • getAllUsers(): ${userService.getAllUsers().length} users
  • Roles available: ${Object.values(userModule.ROLES).join(', ')}
  
✉️ Validation Tests:
  • validateEmail('test@example.com'): ${userModule.validateEmail('test@example.com')}
  • validateEmail('invalid'): ${userModule.validateEmail('invalid')}
  
📄 Formatting Tests:
  • formatUser(): ${userModule.formatUser(userService.getAllUsers()[0])}`;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `❌ User module test failed: ${error.message}`;
            }
        };
        
        window.testConfigModule = async function() {
            const output = document.getElementById('debug-output');
            output.className = 'output info';
            output.textContent = '🔧 Testing configuration module...';
            
            try {
                const configModule = await import('/esm/config.js');
                
                output.className = 'output success';
                output.textContent = `✅ Config Module Debug Results:

🔍 Module Exports:
  • Available exports: ${Object.keys(configModule).join(', ')}
  
⚙️ Configuration:
  • Environment: ${configModule.config.environment}
  • Version: ${configModule.getVersion()}
  • Is Production: ${configModule.isProduction()}
  • Is Development: ${configModule.isDevelopment()}
  
🗄️ Database Config:
  • Host: ${configModule.config.database.host}
  • Port: ${configModule.config.database.port}
  • Name: ${configModule.config.database.name}
  
🌐 API Config:
  • Base URL: ${configModule.config.api.baseUrl}
  • Timeout: ${configModule.config.api.timeout}ms
  
🚀 Features:
${Object.entries(configModule.config.features).map(([key, value]) => 
  `  • ${key}: ${value ? '✅' : '❌'}`).join('\n')}`;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `❌ Config module test failed: ${error.message}`;
            }
        };
        
        window.testAllModules = async function() {
            const output = document.getElementById('debug-output');
            output.className = 'output info';
            output.textContent = '🔧 Testing all modules...';
            
            try {
                console.time('All Modules Load');
                
                const [mathModule, userModule, configModule] = await Promise.all([
                    import('/esm/math-utils.js'),
                    import('/esm/user-service.js'),
                    import('/esm/config.js')
                ]);
                
                console.timeEnd('All Modules Load');
                
                output.className = 'output success';
                output.textContent = `✅ All Modules Loaded Successfully!

📊 Summary:
  • Math Module: ${Object.keys(mathModule).length} exports
  • User Module: ${Object.keys(userModule).length} exports  
  • Config Module: ${Object.keys(configModule).length} exports
  • Total load time: Check console
  
🧪 Quick Tests:
  • Math: 2 + 3 = ${mathModule.add(2, 3)}
  • User: ${new userModule.default().getAllUsers().length} users loaded
  • Config: ${configModule.config.environment} environment
  
🚀 All systems operational!`;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `❌ Module loading failed: ${error.message}`;
            }
        };
        
        window.analyzeBrowserCapabilities = function() {
            const output = document.getElementById('browser-analysis');
            
            output.className = 'output info';
            let analysis = '🔍 Browser Capability Analysis:\n\n';
            
            // ES Modules support
            analysis += `📦 ES Modules Support:\n`;
            analysis += `  • Native ES Modules: ${'noModule' in HTMLScriptElement.prototype ? '✅' : '❌'}\n`;
            analysis += `  • Dynamic import(): ${typeof import === 'function' ? '✅' : '❌'}\n`;
            analysis += `  • import.meta: ${typeof import.meta !== 'undefined' ? '✅' : '❌'}\n`;
            analysis += `  • Top-level await: ✅ (in modules)\n\n`;
            
            // Browser info
            analysis += `🌐 Browser Information:\n`;
            analysis += `  • User Agent: ${navigator.userAgent.split(' ').slice(-2).join(' ')}\n`;
            analysis += `  • Platform: ${navigator.platform}\n`;
            analysis += `  • Language: ${navigator.language}\n`;
            analysis += `  • Online: ${navigator.onLine ? '✅' : '❌'}\n\n`;
            
            // Network capabilities
            analysis += `📡 Network Capabilities:\n`;
            analysis += `  • Connection: ${navigator.connection ? navigator.connection.effectiveType : 'Unknown'}\n`;
            analysis += `  • Service Workers: ${'serviceWorker' in navigator ? '✅' : '❌'}\n`;
            analysis += `  • WebSockets: ${'WebSocket' in window ? '✅' : '❌'}\n\n`;
            
            // Performance API
            analysis += `⚡ Performance API:\n`;
            analysis += `  • Performance: ${typeof performance !== 'undefined' ? '✅' : '❌'}\n`;
            analysis += `  • Resource Timing: ${typeof performance.getEntriesByType !== 'undefined' ? '✅' : '❌'}\n`;
            analysis += `  • Navigation Timing: ${typeof performance.navigation !== 'undefined' ? '✅' : '❌'}\n\n`;
            
            // Current page info
            analysis += `📄 Current Page:\n`;
            analysis += `  • Protocol: ${window.location.protocol}\n`;
            analysis += `  • Host: ${window.location.host}\n`;
            analysis += `  • Module URL: ${import.meta.url}\n`;
            
            output.textContent = analysis;
        };
        
        window.testModuleFeatures = async function() {
            const output = document.getElementById('browser-analysis');
            output.className = 'output info';
            output.textContent = '🧪 Testing module features...';
            
            try {
                let results = '🧪 Module Feature Test Results:\n\n';
                
                // Test import.meta
                results += `🔗 import.meta:\n`;
                results += `  • URL: ${import.meta.url}\n`;
                results += `  • Available: ✅\n\n`;
                
                // Test dynamic imports
                results += `⚡ Dynamic Import Test:\n`;
                const startTime = performance.now();
                await import('/esm/math-utils.js');
                const endTime = performance.now();
                results += `  • Dynamic import: ✅\n`;
                results += `  • Load time: ${(endTime - startTime).toFixed(2)}ms\n\n`;
                
                // Test module caching
                results += `🗄️ Module Caching:\n`;
                const cached1 = await import('/esm/math-utils.js');
                const cached2 = await import('/esm/math-utils.js');
                results += `  • Same instance: ${cached1 === cached2 ? '✅' : '❌'}\n`;
                results += `  • Caching works: ✅\n\n`;
                
                // Test error handling
                results += `🛡️ Error Handling:\n`;
                try {
                    await import('/non-existent-module.js');
                    results += `  • Error handling: ❌ (should have failed)\n`;
                } catch {
                    results += `  • Error handling: ✅\n`;
                }
                
                output.className = 'output success';
                output.textContent = results;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `❌ Feature test failed: ${error.message}`;
            }
        };
        
        window.clearDebugOutput = function() {
            document.getElementById('debug-output').textContent = '🔧 Debug Tool Ready!\n\nClick any button above to test module loading and inspect the results.';
            document.getElementById('debug-output').className = 'output';
            
            document.getElementById('browser-analysis').textContent = 'Click "Analyze Browser" to see detailed browser capability analysis!';
            document.getElementById('browser-analysis').className = 'output';
        };
        
        console.log('🔧 Debug script loaded and ready!');
    </script>
</body>
</html>