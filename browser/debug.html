<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ ES Modules Debug</title>
    <link rel="stylesheet" href="/browser/css/design-system.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ ES Modules Debug Tool</h1>
            <p>Debug and test ES module loading behavior in your browser</p>
        </div>
        
        <nav class="nav">
            <a href="/" class="nav-link">ğŸ  Home</a>
            <a href="/esm-demo" class="nav-link">ğŸ“¦ ES Modules</a>
            <a href="/loading-demo" class="nav-link">âš¡ Loading Demo</a>
            <a href="https://github.com/vishal83/JSModulesExploration" target="_blank" class="nav-link">ğŸ“š GitHub</a>
        </nav>
        
        <div class="demo-section">
            <h2>ğŸš€ Module Loading Tests</h2>
            <p>Test individual module loading and inspect the results:</p>
            
            <button onclick="testMathModule()" class="btn btn-primary">Test Math Module</button>
            <button onclick="testUserModule()" class="btn btn-success">Test User Module</button>
            <button onclick="testConfigModule()" class="btn btn-secondary">Test Config Module</button>
            <button onclick="testAllModules()" class="btn btn-outline">Test All Modules</button>
            
            <div id="debug-output" class="output">
ğŸ”§ Debug Tool Ready!

Click any button above to test module loading and inspect the results.
This tool will show detailed information about module imports and exports.
            </div>
        </div>
        
        <div class="demo-section">
            <h2>ğŸ” Browser Environment Analysis</h2>
            <p>Analyze browser capabilities and module support:</p>
            
            <button onclick="analyzeBrowserCapabilities()" class="btn btn-primary">Analyze Browser</button>
            <button onclick="testModuleFeatures()" class="btn btn-success">Test Module Features</button>
            <button onclick="clearDebugOutput()" class="btn btn-secondary">Clear Output</button>
            
            <div id="browser-analysis" class="output">
Click "Analyze Browser" to see detailed browser capability analysis!
            </div>
        </div>
        
        <div class="info-box">
            <h3>ğŸ› ï¸ Debug Features</h3>
            <ul>
                <li><strong>Module Loading:</strong> Test individual module imports</li>
                <li><strong>Browser Analysis:</strong> Check ES module support and capabilities</li>
                <li><strong>Error Handling:</strong> See detailed error information</li>
                <li><strong>Performance:</strong> Measure module loading times</li>
                <li><strong>Network Inspection:</strong> Analyze HTTP requests</li>
            </ul>
        </div>
    </div>
    
    <script type="module">
        console.log('ğŸ”§ Debug tool initialized');
        
        window.testMathModule = async function() {
            const output = document.getElementById('debug-output');
            output.className = 'output info';
            output.textContent = 'ğŸ”§ Testing math module...';
            
            try {
                console.time('Math Module Load');
                const mathModule = await import('/esm/math-utils.js');
                console.timeEnd('Math Module Load');
                
                output.className = 'output success';
                output.textContent = `âœ… Math Module Debug Results:

ğŸ” Module Analysis:
  â€¢ Import successful: âœ…
  â€¢ Module type: ${typeof mathModule}
  â€¢ Exports found: ${Object.keys(mathModule).length}
  â€¢ Export names: ${Object.keys(mathModule).join(', ')}

ğŸ§® Function Tests:
  â€¢ add(10, 5) = ${mathModule.add(10, 5)}
  â€¢ multiply(3, 7) = ${mathModule.multiply(3, 7)}
  â€¢ PI constant = ${mathModule.PI}
  â€¢ E constant = ${mathModule.E}

ğŸ—ï¸ Constructor Tests:
  â€¢ Calculator available: ${typeof mathModule.Calculator === 'function' ? 'âœ…' : 'âŒ'}
  â€¢ Calculator instance: ${mathModule.Calculator ? new mathModule.Calculator('Debug').name : 'N/A'}

ğŸ“Š Performance:
  â€¢ Check console for loading time
  â€¢ Module cached: ${performance.getEntriesByName('/esm/math-utils.js').length > 0}`;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `âŒ Math module test failed:
                
Error: ${error.name}
Message: ${error.message}
Stack: ${error.stack}

Debug info:
  â€¢ Module path: /esm/math-utils.js
  â€¢ Import type: dynamic import()
  â€¢ Browser support: ${typeof import !== 'undefined' ? 'âœ…' : 'âŒ'}`;
            }
        };
        
        window.testUserModule = async function() {
            const output = document.getElementById('debug-output');
            output.className = 'output info';
            output.textContent = 'ğŸ”§ Testing user service module...';
            
            try {
                const userModule = await import('/esm/user-service.js');
                const userService = new userModule.default();
                
                output.className = 'output success';
                output.textContent = `âœ… User Service Module Debug Results:

ğŸ” Module Analysis:
  â€¢ Default export: ${typeof userModule.default}
  â€¢ Named exports: ${Object.keys(userModule).filter(key => key !== 'default').join(', ')}
  
ğŸ‘¥ Service Tests:
  â€¢ UserService instantiated: âœ…
  â€¢ getAllUsers(): ${userService.getAllUsers().length} users
  â€¢ Roles available: ${Object.values(userModule.ROLES).join(', ')}
  
âœ‰ï¸ Validation Tests:
  â€¢ validateEmail('test@example.com'): ${userModule.validateEmail('test@example.com')}
  â€¢ validateEmail('invalid'): ${userModule.validateEmail('invalid')}
  
ğŸ“„ Formatting Tests:
  â€¢ formatUser(): ${userModule.formatUser(userService.getAllUsers()[0])}`;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `âŒ User module test failed: ${error.message}`;
            }
        };
        
        window.testConfigModule = async function() {
            const output = document.getElementById('debug-output');
            output.className = 'output info';
            output.textContent = 'ğŸ”§ Testing configuration module...';
            
            try {
                const configModule = await import('/esm/config.js');
                
                output.className = 'output success';
                output.textContent = `âœ… Config Module Debug Results:

ğŸ” Module Exports:
  â€¢ Available exports: ${Object.keys(configModule).join(', ')}
  
âš™ï¸ Configuration:
  â€¢ Environment: ${configModule.config.environment}
  â€¢ Version: ${configModule.getVersion()}
  â€¢ Is Production: ${configModule.isProduction()}
  â€¢ Is Development: ${configModule.isDevelopment()}
  
ğŸ—„ï¸ Database Config:
  â€¢ Host: ${configModule.config.database.host}
  â€¢ Port: ${configModule.config.database.port}
  â€¢ Name: ${configModule.config.database.name}
  
ğŸŒ API Config:
  â€¢ Base URL: ${configModule.config.api.baseUrl}
  â€¢ Timeout: ${configModule.config.api.timeout}ms
  
ğŸš€ Features:
${Object.entries(configModule.config.features).map(([key, value]) => 
  `  â€¢ ${key}: ${value ? 'âœ…' : 'âŒ'}`).join('\n')}`;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `âŒ Config module test failed: ${error.message}`;
            }
        };
        
        window.testAllModules = async function() {
            const output = document.getElementById('debug-output');
            output.className = 'output info';
            output.textContent = 'ğŸ”§ Testing all modules...';
            
            try {
                console.time('All Modules Load');
                
                const [mathModule, userModule, configModule] = await Promise.all([
                    import('/esm/math-utils.js'),
                    import('/esm/user-service.js'),
                    import('/esm/config.js')
                ]);
                
                console.timeEnd('All Modules Load');
                
                output.className = 'output success';
                output.textContent = `âœ… All Modules Loaded Successfully!

ğŸ“Š Summary:
  â€¢ Math Module: ${Object.keys(mathModule).length} exports
  â€¢ User Module: ${Object.keys(userModule).length} exports  
  â€¢ Config Module: ${Object.keys(configModule).length} exports
  â€¢ Total load time: Check console
  
ğŸ§ª Quick Tests:
  â€¢ Math: 2 + 3 = ${mathModule.add(2, 3)}
  â€¢ User: ${new userModule.default().getAllUsers().length} users loaded
  â€¢ Config: ${configModule.config.environment} environment
  
ğŸš€ All systems operational!`;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `âŒ Module loading failed: ${error.message}`;
            }
        };
        
        window.analyzeBrowserCapabilities = function() {
            const output = document.getElementById('browser-analysis');
            
            output.className = 'output info';
            let analysis = 'ğŸ” Browser Capability Analysis:\n\n';
            
            // ES Modules support
            analysis += `ğŸ“¦ ES Modules Support:\n`;
            analysis += `  â€¢ Native ES Modules: ${'noModule' in HTMLScriptElement.prototype ? 'âœ…' : 'âŒ'}\n`;
            analysis += `  â€¢ Dynamic import(): ${typeof import === 'function' ? 'âœ…' : 'âŒ'}\n`;
            analysis += `  â€¢ import.meta: ${typeof import.meta !== 'undefined' ? 'âœ…' : 'âŒ'}\n`;
            analysis += `  â€¢ Top-level await: âœ… (in modules)\n\n`;
            
            // Browser info
            analysis += `ğŸŒ Browser Information:\n`;
            analysis += `  â€¢ User Agent: ${navigator.userAgent.split(' ').slice(-2).join(' ')}\n`;
            analysis += `  â€¢ Platform: ${navigator.platform}\n`;
            analysis += `  â€¢ Language: ${navigator.language}\n`;
            analysis += `  â€¢ Online: ${navigator.onLine ? 'âœ…' : 'âŒ'}\n\n`;
            
            // Network capabilities
            analysis += `ğŸ“¡ Network Capabilities:\n`;
            analysis += `  â€¢ Connection: ${navigator.connection ? navigator.connection.effectiveType : 'Unknown'}\n`;
            analysis += `  â€¢ Service Workers: ${'serviceWorker' in navigator ? 'âœ…' : 'âŒ'}\n`;
            analysis += `  â€¢ WebSockets: ${'WebSocket' in window ? 'âœ…' : 'âŒ'}\n\n`;
            
            // Performance API
            analysis += `âš¡ Performance API:\n`;
            analysis += `  â€¢ Performance: ${typeof performance !== 'undefined' ? 'âœ…' : 'âŒ'}\n`;
            analysis += `  â€¢ Resource Timing: ${typeof performance.getEntriesByType !== 'undefined' ? 'âœ…' : 'âŒ'}\n`;
            analysis += `  â€¢ Navigation Timing: ${typeof performance.navigation !== 'undefined' ? 'âœ…' : 'âŒ'}\n\n`;
            
            // Current page info
            analysis += `ğŸ“„ Current Page:\n`;
            analysis += `  â€¢ Protocol: ${window.location.protocol}\n`;
            analysis += `  â€¢ Host: ${window.location.host}\n`;
            analysis += `  â€¢ Module URL: ${import.meta.url}\n`;
            
            output.textContent = analysis;
        };
        
        window.testModuleFeatures = async function() {
            const output = document.getElementById('browser-analysis');
            output.className = 'output info';
            output.textContent = 'ğŸ§ª Testing module features...';
            
            try {
                let results = 'ğŸ§ª Module Feature Test Results:\n\n';
                
                // Test import.meta
                results += `ğŸ”— import.meta:\n`;
                results += `  â€¢ URL: ${import.meta.url}\n`;
                results += `  â€¢ Available: âœ…\n\n`;
                
                // Test dynamic imports
                results += `âš¡ Dynamic Import Test:\n`;
                const startTime = performance.now();
                await import('/esm/math-utils.js');
                const endTime = performance.now();
                results += `  â€¢ Dynamic import: âœ…\n`;
                results += `  â€¢ Load time: ${(endTime - startTime).toFixed(2)}ms\n\n`;
                
                // Test module caching
                results += `ğŸ—„ï¸ Module Caching:\n`;
                const cached1 = await import('/esm/math-utils.js');
                const cached2 = await import('/esm/math-utils.js');
                results += `  â€¢ Same instance: ${cached1 === cached2 ? 'âœ…' : 'âŒ'}\n`;
                results += `  â€¢ Caching works: âœ…\n\n`;
                
                // Test error handling
                results += `ğŸ›¡ï¸ Error Handling:\n`;
                try {
                    await import('/non-existent-module.js');
                    results += `  â€¢ Error handling: âŒ (should have failed)\n`;
                } catch {
                    results += `  â€¢ Error handling: âœ…\n`;
                }
                
                output.className = 'output success';
                output.textContent = results;
                
            } catch (error) {
                output.className = 'output error';
                output.textContent = `âŒ Feature test failed: ${error.message}`;
            }
        };
        
        window.clearDebugOutput = function() {
            document.getElementById('debug-output').textContent = 'ğŸ”§ Debug Tool Ready!\n\nClick any button above to test module loading and inspect the results.';
            document.getElementById('debug-output').className = 'output';
            
            document.getElementById('browser-analysis').textContent = 'Click "Analyze Browser" to see detailed browser capability analysis!';
            document.getElementById('browser-analysis').className = 'output';
        };
        
        console.log('ğŸ”§ Debug script loaded and ready!');
    </script>
</body>
</html>